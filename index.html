<!DOCTYPE html>

<html>
<head>
  <title>Live Location Tracker</title>
  <style>
    html, body {
      height: 100%; margin: 0; padding: 0;
      font-family: Arial, sans-serif;
    }
    #map {
      height: 100%; width: 100%;
    }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-database.js"></script>
  <!-- Google Maps -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD_30AhRGo_nExxR-24zp7MgBpy37Jhaj0"></script>
</head>
<body>
  <div id="map"></div>
 <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyAgS3DO8yFpB5gp2eIiyZ8KjZMLgU3S6H4",
    authDomain: "map-api-project-ff783.firebaseapp.com",
    projectId: "map-api-project-ff783",
    storageBucket: "map-api-project-ff783.firebasestorage.app",
    messagingSenderId: "953800442877",
    appId: "1:953800442877:web:d0780767b4e66a0e330f94",
    measurementId: "G-JNZZ7R6GPE"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>
  <script>

    // 2. Unique user ID (simulate)
    const uid = 'user_' + Math.floor(Math.random() * 10000);

    // 3. Map setup
    let map;
    const markers = {};

    function initMap(position) {
      const latLng = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      map = new google.maps.Map(document.getElementById("map"), {
        center: latLng,
        zoom: 15
      });

      updateMyLocation(latLng);
      listenForOthers();
    }

    // 4. Update own location to Firebase
    function updateMyLocation(latLng) {
      database.ref("users/" + uid).set({
        name: uid,
        location: latLng
      });
    }

    // 5. Read all users' locations and show on map
    function listenForOthers() {
      database.ref("users").on("value", (snapshot) => {
        const data = snapshot.val();
        for (const id in data) {
          const user = data[id];
          const loc = user.location;

          if (markers[id]) {
            markers[id].setPosition(loc);
          } else {
            markers[id] = new google.maps.Marker({
              map: map,
              position: loc,
              title: user.name,
              icon: id === uid ? 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png' : undefined
            });
          }
        }
      });
    }

    // 6. Watch location
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(initMap);
      navigator.geolocation.watchPosition((pos) => {
        const latLng = {
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        };
        updateMyLocation(latLng);
      });
    } else {
      alert("Geolocation is not supported by this browser.");
    }
  </script>

 
  
</body>
</html>
